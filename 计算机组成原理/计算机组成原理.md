# 计算机组成原理

## 概论

### 计算机系统概论

#### 计算机系统简介

**计算机的软硬件概念**

硬件:计算机的实体部分
软件:由人们编辑的有各类特殊功能的程序
- 系统软件:
  * 标准程序库
  * 语言处理程序
  * 操作系统
  * 服务程序
  * 数据库管理系统
  * 网络软件
- 应用软件

**计算机系统的层次结构**

1. 虚拟机器\(M_4\)(高级语言机器)用编译程序编译成汇编语言程序
2. 虚拟机器\(M_3\)(汇编语言机器)用汇编语言翻译成机器语言程序
3. 虚拟机器\(M_2\)(操作系统机器)用机器语言解释操作系统
4. 虚拟机器\(M_1\)(机器语言机器)用微程序解析机器指令
5. 虚拟机器\(M_0\)(微指令机器)由硬件直接执行微指令

**计算机组成和计算机体系结构**

- **计算机体系结构**:是指那些能够被程序员所见到的计算机属性。所看到的计算机属性，包括指令集、数据类型、存储器寻址技术、I/O机理等（抽象，概念性）
比如IBM PC和 RS6000 是具有不同的指令集、数据类型、存储器寻址技术、I/O机理，所以这两种机器的结构各不相同。
- **计算机组成**:就是如何具体实现这些计算机结构所体现的属性，比如硬件细节，指令集体现了机器的属性，这是结构问题。但指令的实现，比如如何取指令、分析指令、取操作数等等，这些都是计算机组成问题

#### 计算机的基本组成

**冯诺依曼计算机的特点**

1. 冯·诺依曼计算机主要由五大部件组成，分别是：运算器、控制器、存储器、输入设备和输出设备
2. 冯诺依曼体系结构的指令和数据均采用二进制码表示
3. 指令和数据以同等地位存放于存储器中，均可按地址寻访
4. 指令由操作码和地址码组成，操作码用来表示操作的性质，地址码用来表示操作数所在存储器中的位
5. 指令在存储器中按顺序存放，通常指令是按顺序执行的，特定条件下，可以根据运算结果或者设定的条件改变执行顺序
6. 机器以运算器为中心，输入输出设备和存储器的数据传送通过运算器

**计算机的硬件框图**

![典型的诺依曼计算机结构框图](./images/屏幕截图%202023-12-02%20133031.png)

- 运算器：算术运算、逻辑运算； 
- 储存器： 存放数据与程序； 
- 控制器： 指挥程序的运行，语句的执行顺序； 
- 输入设备： 将信息转换为机器能够识别的形式； 
- 输出设备： 将结果转换为人们熟悉的形式

![以存储器为中心的计算机结构框图](./images/屏幕截图%202023-12-02%20133325.png)

![现代计算机的组成框图](./images/屏幕截图%202023-12-02%20133252.png)

- 主存储器可以直接与CPU交换信息； 
- 辅助存存储器又称辅存，又称外存； 
- ALU: 算术逻辑单元，完成算术逻辑运算； 
- CU: 控制单元，用来解释存储器的指令，并发出各种操作命令来执行指令

##### 计算机的工作步骤

**上机前的准备**

1. 建立数学模型
2. 确定计算方法
3. 编制解题程序

指令 = 操作码 + 地址码

![程序清单](./images/屏幕截图%202023-12-02%20133832.png)

**计算机的工作过程**


1. 主存储器

    ![主存储器](./images/屏幕截图%202023-12-02%20134819.png)

2. 运算器

    ![运算器](./images/屏幕截图%202023-12-02%20135017.png)

    运算器最少包括3个寄存器（ACC-累加器，MQ-乘商寄存器，X-操作数寄存器）和一个算术逻辑单元（ALU）；

3. 控制器

    ![控制器](./images/屏幕截图%202023-12-02%20135134.png)

    1. PC 用来存放当前将要执行的指令地址，它与主存的MAR之间有一条直接的通路，可自动加一形成下一条指令的地址。
    2. IR 用来存放当前的指令，IR的内容来自主存的MDR。分析指令：OP(IR)--->CU.
    3. CU 用来分析当前指令所需要完成的操作，并发出各种微操作命令序列，用来控制所有被控对象。

4. I/O

![细化的计算机组成框图](./images/屏幕截图%202023-12-02%20134525.png)

#### 计算机硬件的主要技术指标

##### 1.3.1机器字长

**机器字长**:是指CPU一次能处理数据的位数，通常与CPU的寄存器位数有关。 字长越长，数的表示范围越大,精度也越高。机器的字长也会影响机器的运算速度。倘若CPU字长较短,又要运算位数较多的数据,那么需要经过两次或多次的运算才能完成，这样势必影响机器的运算速度

##### 1.3.2存储容量

**储存容量**:是指存放二进制代码的总位数。存储器的容量应该包括：主存容量和辅存容量。MAR的位数反映了存储单元的个数,MDR的位数反映了存储字长
\[储存容量=存储单元的个数\times存储字长\]

##### 1.3.3运算速度

![运算速度](./images/屏幕截图%202023-12-02%20135901.png)


### 计算机的发展及应用

#### 计算机的发展史

#### 计算机的应用

#### 计算机的展望

## 计算机系统的硬件结构

### 系统总线

#### 总线的基本概念

互联方式有两种

- 分散连接
- 总线连接

总线是连接各个部件的信息传输线，是各个部件共享的传输介质。 

![面向 CPU 的双总线结构框图](./images/屏幕截图%202023-12-02%20140222.png)

![单总线结构框图](./images/屏幕截图%202023-12-02%20140521.png)

![以存储器为中心的双总线结构框图](./images/屏幕截图%202023-12-02%20140603.png)

#### 总线的分类

**按数据传输方式分类**

- 并行传输
- 串行传输

**按连接部件**

##### 片内总线

芯片内部的总线如在cpu内部,寄存器和寄存器之间

##### 系统总线

计算机各部件之间的信息传输线如在CPU,主存,IO各大部件之间的传输线

**按系统总线传输信息不同**

1. 数据总线
用来传输个功能部件之间的数据信息
双向传输线
位数和机器字长有关

2. 地址总线
用来指出数据总线上的源数据或目的数据在主存或IO的地址
~~单向传输~~
位数和存储单元的个数有关

3. 控制总线
发出控制信号的传输线
单向传输
典型控制线有复位、时钟、中断相关、总线请求、存储器读写、I/O 读写、忙闲检测等。

##### 3.2.3通信总线

用于计算机系统之间或计算机系统与其他系统之间的通信
如网线

#### 3.3总线特性及性能指标

##### 3.3.1总线特性

1. 机械特性
尺寸、形状、管脚数及排列顺序

2. 电气特性
传输方向和有效的电平范围

3. 功能特性
每根传输线的功能如,传输地址,数据,控制中断

4. 时间特性
信号的时序关系

##### 3.3.2总线性能指标

1. 总线宽度
2. 总线带宽
3. 时钟同步/异步
4. 总线复用
5. 信号线数
6. 总线控制方式

##### 3.3.3 总线标准

#### 总线结构

##### 3.4.1单总线结构

![单总线结构框图](./images/屏幕截图%202023-12-02%20140521.png)

单总线结构在计算机组成原理中存在一些缺陷:

1. **性能瓶颈**：单总线结构只有一个总线传输数据和指令，这导致在任何时刻只能有一个操作进行。当多个组件（如CPU、内存、I/O设备等）竞争使用总线时，会造成性能瓶颈，降低整体系统的速度。

2. **数据传输冲突**：多个设备共享同一条总线，容易发生数据传输冲突。如果多个设备同时请求总线访问，可能导致冲突和数据丢失，需要额外的控制机制来处理这种冲突。

3. **有限的带宽**：单总线结构的带宽是固定的，并且有限于总线的宽度。这意味着一次只能传输有限数量的数据位，限制了数据传输速率。

4. **扩展性差**：单总线结构对系统的扩展性有一定限制。随着系统的发展和对更多设备的需求，单总线可能无法满足高带宽、高速度和多设备的要求，因而限制了系统的扩展性。

##### 3.4.2多总线结构

![双总线结构](./images/屏幕截图%202023-12-02%20144205.png)

将低速的IO设备从总线上分离

![三总线结构](./images/屏幕截图%202023-12-02%20144420.png)

![另一形式的三总线结构](./images/屏幕截图%202023-12-02%20144531.png)

![四总线结构](./images/屏幕截图%202023-12-02%20144620.png)

##### 3.4.3总线结构举例

![传统微型计算机总线结构](./images/屏幕截图%202023-12-02%20144729.png)

![VL-BUS局部总线结构](./images/屏幕截图%202023-12-02%20144818.png)

![多层PCI总线结构](./images/屏幕截图%202023-12-02%20144914.png)

#### 3.5总线控制

##### 3.5.1总线判优控制

主设备对总线有控制权
从设备响应从主设备发来的总线命令

集中式:将控制逻辑集中在CPU

1. 链式查询
    ![链式查询](./images/屏幕截图%202023-12-02%20145532.png)

    实现简单
    容易扩充设备
    对电路故障敏感
    优先级低的设备很难获得请求

2. 计数器定时查询
    ![计数器定时查询](./images/屏幕截图%202023-12-02%20145753.png)

    计数可以从0开始这样设备的优先级就被固定
    也可以从上次计数的终点开始这样设备的优先级相等
    初始值还可以随意设置优先次序可变

3. 独立请求方式
![独立请求方式](./images/屏幕截图%202023-12-02%20150247.png)

相应速度快
优先次序灵活
控制线数量多
总线控制复杂

##### 3.5.2总线通信控制

完成一次总线操作的时间称为总线周期

1. 申请分配阶段
2. 寻址阶段
3. 传数阶段
4. 结束阶段

**总线通信控制的四种方法**

1. 同步通信
    ![同步通信](./images/屏幕截图%202023-12-02%20151033.png)

    采用统一的时钟信号控制主模块和从模块

    \(T_{1}\) 的上升沿到来时，主模块向从模块发送地址
    \(T_{2}\) 的上升沿到来时，主模块发送读命令
    \(T_{3}\) 的上升沿到来时，从模块提供数据
    \(T_{4}\) 的上升沿到来时，主模块撤销读命令，从模块撤销数据

    在每一个时钟周期内主设备或从设备都必须完成规定的操作，因为时钟周期是按最慢的设备来设定的，所以根本没有必要担心从模块在 \(T_{3}\) 时间内没有足够的时间提供数据。

    但是由于计算机中不同设备的速度是不同的，对于速度较快的设备完成操作的时间小于公共的时钟周期，**这种强制的同步势必造成时间的浪费，影响总线工作的效率**。


2. 异步通信

    异步通信通信克服了同步通信的缺点，允许各个设备的速度不一致，没有公共的时钟标准，采用应答方式

    1. **不互锁**
    主设备发出请求信号后，不必等待接收到从设备的回答信号，而是经过一段时间确认从设备收到信号了就把请求信号撤销（应该可以理解为主设备觉得从设备是收到了就撤销了信号）；从设备在收到请求信号后再条件允许的时候发出回答信号，过一段时间确认主设备收到回答信号后撤销回答信号（从设备觉得主设备是收到了的就撤销了信号）

    2. **半互锁**
    主设备发出请求信号后必须等待接到从设备的回答信号后才撤销请求信号，而从设备不必等待获知主设备的请求信号已经撤销，而是过一段时间自动撤销回答信号

    3. **全互锁**
    主设备必须等待接到从设备的回答信号后才撤销请求信号，从设备必须获知主设备撤销了请求信号才撤销回答信号


3. 半同步通信
![半同步通信数据输入过程](./images/屏幕截图%202023-12-02%20151959.png)

半同步通信没有像同步通信那种必须在限定时间内完成规定的要求，没有公共的时钟，但保留了同步通信的基本特点，比如说数据、地址、命令信号的发出都严格参照系统时钟的某个上升沿开始。这种通信方式增设了一条等待响应信号线。

\(T_{2}\) 结束后如果从设备没有准备好数据就可以发一个等待信号，如果主模块在 \(T_{3}\)  到来前测到了这个等待信号就插入一个等待周期 \(T_{w}\)  (宽度和时钟周期一致)，如果在下一个周期有测到了等待信号就在插入一个等待周期，如果没有测到就把下一个周期当做正常的周期 \(T_{3}\)  。这里的 \(T_{n}\) (n=1,2,3,4,w) 和同步通信的 T 不一定相等

4. 分离式通信

    充分挖掘系统总线每个瞬间的潜力

    一个总线传输周期

    子周期1 ：主模块申请占用总线，使用完后即放弃总线的使用权。
    子周期2：从模块申请占用总线，将各种信息送至总线上。

    分离式通信特点：
    1. 各模块有权申请占用总线
    2. 采用同步方式通信，不等对方回答
    3. 各模块准备数据时，不占用总线
    4. 总线被占用时，无空闲
    
    实现复杂

### 储存器

#### 概述

##### 4.1.1 存储器分类

**按储存介质分类**
半导体
磁表面
磁芯
光盘

**按存取方式**
随机存储器(RAM random access memory)

- 动态RAM
- 静态RAM

只读存储器(ROM read only memory)

- 掩模型只读存储器(masked ROM,MROM)
- 可编程只读存储器(programmable ROM,PROM)
- 可擦除只读存储器(erasable programmable ROM,EPROM)
- 电可擦除只读存储器(electrically-erasable programmable ROM,EEPROM)
- 闪速存储器(flash memory)

串行访问存储器

**按作用**

主存储器
辅助存储器
缓存存储器

##### 4.1.2存储器的层次结构

存储器的三个主要特性的关系:速度,容量,价格/位

![存储器速度,容量和价格的关系](./images/屏幕截图%202023-12-02%20154524.png)

![层次结构](./images/屏幕截图%202023-12-02%20154606.png)

**缓存-主存**:解决CPU和组成速度不匹配问题
**主存-辅存**:解决存储系统容量问题

#### 主存储器

##### 4.2.1概述

![主存的基本组成](./images/屏幕截图%202023-12-02%20154841.png)

![主存和CPU的联系](./images/屏幕截图%202023-12-02%20155013.png)

**内存中存储单元地址的分配**

![字节寻址的主存地址分配](./images/屏幕截图%202023-12-02%20155154.png)

**主存的技术指标**

1. 存储容量
2. 存储速度
3. 存储器带宽

##### 4.2.2半导体存储芯片简介

![半导体存储芯片的基本结构](./images/屏幕截图%202023-12-02%20155611.png)

**半导体存储芯片的译码驱动方式**

![线选法](./images/屏幕截图%202023-12-02%20155939.png)

![重合法](./images/屏幕截图%202023-12-02%20160045.png)

##### 随机存取存储器

**静态RAM(SRAM)**

![静态RAM的基本电路](./images/屏幕截图%202023-12-02%20160233.png)

![静态RAM的读操作](./images/屏幕截图%202023-12-02%20160313.png)

![静态RAM的写操作](./images/屏幕截图%202023-12-02%20160412.png)

**动态RAM(DRAM)**

![动态RAM的基本电路](./images/屏幕截图%202023-12-02%20160559.png)

**动态RAM的刷新**

集中刷新

![集中刷新](./images/屏幕截图%202023-12-02%20160851.png)

分散刷新

![分散刷新](./images/屏幕截图%202023-12-02%20161113.png)

异步刷新

![异步刷新](./images/屏幕截图%202023-12-02%20161237.png)

**动态RAM和静态RAM的比较**

![比较](./images/屏幕截图%202023-12-02%20161434.png)

##### 4.2.4只读存储器

**掩模ROM**:用户无法改变原始状态
**PROM**:可以实现一次性编程
**EPROM**:可以做任意次的改写
**EEPROM**:重写速度快

##### 4.2.5存储器和CPU的连接

**存储容量的扩展**

![位扩展](./images/屏幕截图%202023-12-02%20162558.png)

![字扩展](./images/屏幕截图%202023-12-02%20162757.png)

\(A_{10}\)位片选信号

![位,字扩展](./images/屏幕截图%202023-12-02%20162930.png)

**存储器与CPU的连接**

##### 4.2.6存储器的校验

汉明码

检测的二进制代码为n位,需要加k位检测位需满足
\[2^k \geqslant n+k+1\]

汉明码采用分组和奇偶校验

![练习1](./images/屏幕截图%202023-12-02%20163931.png)

![练习2](./images/屏幕截图%202023-12-02%20164120.png)

##### 4.2.7提高访存速度的措施

![单体多字系统](./images/屏幕截图%202023-12-02%20164352.png)

**多体并行系统**

![高位交叉](./images/屏幕截图%202023-12-02%20164740.png)

![低位交叉](./images/屏幕截图%202023-12-02%20164825.png)

当计算机并行读取数据时低位交叉可以实现同时访问多个存储体加快访问

![低位交叉编址的多体存储器](./images/屏幕截图%202023-12-02%20165057.png)

![四体低位交叉编址存储器流水线工作方式](./images/屏幕截图%202023-12-02%20165144.png)

**高性能存储芯片**

SDRAM
RDRAM
带cache的DRAM(CDRAM)

#### 高速存储器

##### 4.3.1概述

程序访问的局部性原理

![主存的缓存的编址](./images/屏幕截图%202023-12-02%20170441.png)

命中:需要访问的数据在cache中
未命中:需要访问的数据在不在cache中

效率\(e=\frac{访问cache的时间}{平均访问时间} \times 100\% \)

![cache的基本结构原理框图](./images/屏幕截图%202023-12-02%20171029.png)

![cache的读操作](./images/屏幕截图%202023-12-02%20171157.png)

- 写直达法:
写操作时既写入cache有写入主存
写操作时间就是访问主存时间,cache块退出时不需要其他操作

- 写回法
写操作时只把数据写入cache不写入主存
当cache数据被替换时才写入主存

cache的改进
- 单一缓存和二级缓存
- 统一缓存和分立缓存

##### 4.3.2主存地址映射

![直接映射](./images/屏幕截图%202023-12-02%20171824.png)

![全相连映射](./images/屏幕截图%202023-12-02%20171923.png)

![组相连映射](./images/屏幕截图%202023-12-02%20172106.png)

**替换算法**

先进先出
近期最少使用
随机法

#### 辅助存储器

##### 4.4.1概述

辅助储存器的特点
磁表面储存器的主要技术指标
- 记录密度
- 存储容量
- 平均寻址时间
- 数据传输率
- 误码率

##### 4.4.2 磁记录原理和记录方式

##### 4.4.3 硬磁盘存储器

##### 4.4.4 软磁盘存储器

##### 4.4.5 磁带存储器

##### 4.4.6 循环冗余校验码

##### 4.4.7 光盘存储器

### 输入输出系统

#### 概述

##### 5.1.1 输入输出系统的发展概况

早期
- 分散连接
- CPU和IO设备串行工作
- 程序查询方式

接口模块和DMA阶段
- 总线连接
- CPU和IO设备并行工作
- 中断方式
- DMA方式

具有通道结构阶段

具有IO处理机阶段

##### 5.1.2 输入输出系统的组成

IO软件
- IO指令 
- 通道指令

IO硬件
- 接口模块
- IO设备

##### 5.1.3 IO设备和主机的联系方式

IO设备编织方式
- 统一编址
- 不统一编址

设备寻址
传送方式
联络方式
- 立即响应方式
- 异步工作采用应答信号联络
- 同步工作采用同步时标联络

IO设备和主机的练级方式
- 辐射式
- 总线式

##### IO设备与主机信息传送的控制方式

程序查询方式
程序中断方式
DMA方式

#### IO设备

##### 5.2.1 概述

人机交互设备
计算机信息的存储设备
机-机通信设备

##### 5.2.2 输入设备

键盘
鼠标
触摸屏
其他输入设备
- 光笔
- 画笔与图形板
- 图像输入设备

##### 5.2.3 输出设备

显示设备
- 概述
- 字符显示器
  - 显示存储器
  - 字符发生器
  - CRT控制器
- 图形显示器
- 图像显示器
- IBM PC系列微型计算机的显示标准
  - MDA标准
  - CGA标准
  - EGA标准
  - VGA标准
- 打印设备
  - 打印设备的分类
  - 点阵针式打印机
  - 激光打印机
  - 喷墨打印机
  - 几种打印机的比较

##### 5.2.4 其他IO设备

- 终端设备
- A/D与D/A转换器
- 汉字处理设备
  - 汉字的输入
  - 汉字的存储
  - 汉字的输出

##### 5.2.5 多媒体技术

- 多媒体的定义
- 多媒体计算机的关键技术
  - 视频和音频数据的压缩和解压技术
  - 多媒体专用芯片
  - 大容量存储器
  - 适用于多媒体技术的软件


#### I/O接口

##### 5.3.1 概述

实现设备的选择
实现数据缓存达到数据匹配
实现数据串-并格式的转换
实现电平转换
传送控制命令
反应设备的状态

##### 5.3.2 接口的功能和组成

![IO总线和接口部件](./images/屏幕截图%202023-12-02%20185031.png)

**接口的功能和组成**

|功能|组成|
|----|----|
|选址功能|设备选址电路|
|传送命令功能|命令寄存器、命令译码器|
|传送数据的功能|数据缓冲寄存器|
|反应设备状态的功能|设备状态标记|

设备状态标记
- 完成触发器 D
- 工作触发器 B
- 中断请求触发器 INTR
- 屏蔽触发器 MASK

![IO设备接口的基本组成](./images/屏幕截图%202023-12-02%20190004.png)

#### 5.3.3 接口类型

按数据传输方式分类
- 并行接口
- 串行接口

按功能选择的灵活性
- 可编程接口
- 不可编程接口

按通用性分类
- 通用接口
- 专用接口

按数据传送的控制方式分类
- 程序型接口
- DMA接口

#### 程序查询方式

##### 5.4.1 程序查询流程

按各个IO设备在系统中的优先级别进行逐级查询
需要执行三条指令
1. 测试指令:用来查询IO设备是否已经准备就绪
2. 传送指令:当IO设备已就绪时,执行传送指令
3. 转移指令:若IO设备未准备就绪,执行转移指令转到测试指令

![程序查询方式的程序流程](./images/屏幕截图%202023-12-02%20191437.png)

##### 5.4.2 程序查询方式的接口电路

![程序查询方式的(输入)接口电路](./images/屏幕截图%202023-12-02%20191604.png)

#### 程序中断方式

##### 5.5.1 中断的概念

计算机在执行程序的工程中,当出现异常情况或特殊请求时,计算机停止现行程序的运行,去处理异常或请求,处理完再返回现行程序的间断处继续执行程序

##### 5.5.2 IO中断的产生

![CPU与打印机并行工作的时间示意图](./images/屏幕截图%202023-12-03%20143527.png)

##### 5.5.3 程序中断方式的接口电路

中断请求触发器和中的屏蔽触发器
排队器
中断向量地址形成部件(设备编码器)
程序中断方式接口电路的基本组成

##### 5.5.4 IO中断处理过程

CPU响应中断的条件的时间
IO中断处理过程

##### 5.5.5 中断服务程序的流程

保护现场
中断服务
恢复现场
中断返回

#### DMA方式

##### 5.6.1 DMA方式的特点

主存和设备交换信息不通过CPU

**DMA和主存交换数据时采用的方法**

- 停止CPU访问主存
- 周期挪用(周期窃取)
- DMA和CPU交替访问

##### 5.6.2 DMA接口的功能和组成

**DMA接口的功能**
DMA接口的基本组成
- 主存地址寄存器(AR)
- 字计数器(WC)
- 数据缓冲寄存器(BR)
- DMA控制逻辑
- 中断机构
- 设备地址寄存器(DAR)

##### 5.6.3 DMA的工作过程

DMA传送过程
- 预处理
- 数据传送
- 后处理

DMA接口与系统的连接方式

##### 5.6.4 DMA的接口类型

选择型DMA接口
多路型DMA接口

## 中央处理器

### 计算机的运算方式

#### 无符号数和有符号数

#### 数的顶点表示和浮点表示

#### 定点运算

#### 浮点四则运算

#### 算术逻辑单元

### 指令系统

#### 7.1 机器指令

每条机器语言语句称为机器指令,将全部机器指令的集合称为机器指令系统

##### 7.1.1 指令的一般格式

![指令的一般格式](./images/屏幕截图%202023-12-03%20150153.png)

**操作码**:反映机器做什么操作
长度固定:用于指令字长较长的情况,指令译码时间短
长度可变:操作码分散在指令字的不同字段中
扩展操作码技术
![扩展操作码](./images/屏幕截图%202023-12-03%20151226.png)
三地址指令操作码每减少一种最多可多构成\(2^4\)种二地址指令
二地址指令操作码每减少一种最多可多构成\(2^4\)种一地址指令


****
**地址码**:
四地址指令
三地址指令
二地址指令
一地址指令
零地址指令

#### 操作数类型和操作类型

#### 寻址方式

#### 指令格式举例

